<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>GILDONG: Weight Hacking Protocol</title>
    <style>
        :root {
            --bg-color: #050505;
            --text-color: #00ff41; /* Hacker Green */
            --alert-color: #ff3333;
            --node-bg: #1a1a1a;
            --line-color: #333;
            --glitch-color: #00ffff;
        }
        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Courier New', monospace;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 20px;
            overflow: hidden;
        }
        h1 { font-size: 1.2rem; text-transform: uppercase; letter-spacing: 2px; border-bottom: 1px solid var(--text-color); padding-bottom: 10px; }
        
        /* Dashboard */
        #dashboard {
            display: flex;
            justify-content: space-between;
            width: 80%;
            max-width: 600px;
            margin-bottom: 20px;
            padding: 10px;
            border: 1px solid var(--line-color);
            background: #000;
        }
        .metric { text-align: center; }
        .metric-val { font-size: 1.5rem; font-weight: bold; }
        
        /* The Network Graph */
        #network-container {
            position: relative;
            width: 600px;
            height: 400px;
            border: 1px solid #333;
            background: radial-gradient(circle, #111 0%, #000 100%);
        }
        
        /* Nodes */
        .node {
            position: absolute;
            width: 80px;
            height: 80px;
            background: var(--node-bg);
            border: 2px solid var(--line-color);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            font-size: 0.8rem;
            z-index: 2;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            transition: all 0.3s;
        }
        #node-me { top: 160px; left: 260px; border-color: var(--glitch-color); color: var(--glitch-color); }
        #node-company { top: 40px; left: 100px; }
        #node-bank { top: 40px; left: 420px; }
        #node-food { top: 300px; left: 260px; }

        /* Edges (SVG Lines) */
        svg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none; }
        line { stroke: var(--line-color); stroke-width: 2; }
        .active-connection { stroke: var(--text-color); stroke-dasharray: 5; animation: flow 1s infinite linear; }
        
        @keyframes flow { to { stroke-dashoffset: -10; } }

        /* Hacking Interface (Sliders) */
        .hack-panel {
            position: absolute;
            background: rgba(0, 0, 0, 0.8);
            border: 1px solid var(--text-color);
            padding: 5px;
            font-size: 0.7rem;
            z-index: 3;
            width: 140px;
        }
        input[type=range] { width: 100%; cursor: pointer; }
        
        /* Status Effects */
        .danger { color: var(--alert-color); border-color: var(--alert-color); animation: pulse 0.5s infinite; }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        #log {
            margin-top: 20px;
            width: 80%;
            height: 100px;
            overflow-y: scroll;
            border: 1px solid #333;
            font-size: 0.8rem;
            padding: 5px;
            color: #888;
        }
    </style>
</head>
<body>

    <h1>Project Glitch: Weight Optimization</h1>

    <div id="dashboard">
        <div class="metric">
            <div>LIFE SCORE (Loss Fn)</div>
            <div id="life-score" class="metric-val">0</div>
        </div>
        <div class="metric">
            <div>GILDONG SUSPICION</div>
            <div id="suspicion" class="metric-val">0%</div>
        </div>
    </div>

    <div id="network-container">
        <svg>
            <line id="line-salary" x1="140" y1="80" x2="300" y2="200" />
            <line id="line-interest" x1="460" y1="80" x2="300" y2="200" />
            <line id="line-cost" x1="300" y1="200" x2="300" y2="300" />
        </svg>

        <div id="node-company" class="node">BLACK<br>CORP</div>
        <div id="node-bank" class="node">LOAN<br>SHARK</div>
        <div id="node-me" class="node">ME<br>(Node)</div>
        <div id="node-food" class="node">LIVING<br>COST</div>

        <div class="hack-panel" style="top: 100px; left: 160px;">
            <label>Salary Weight (w1)</label>
            <input type="range" id="w-salary" min="1" max="50" value="10">
            <span id="val-salary">10</span>
        </div>

        <div class="hack-panel" style="top: 100px; left: 320px;">
            <label>Debt Interest (w2)</label>
            <input type="range" id="w-interest" min="5" max="100" value="50">
            <span id="val-interest">50</span>
        </div>
        
        <div class="hack-panel" style="top: 240px; left: 340px;">
             <label>Living Cost (w3)</label>
             <input type="range" id="w-cost" min="10" max="50" value="30">
             <span id="val-cost">30</span>
        </div>
    </div>

    <div id="log">
        > SYSTEM BOOT...<br>
        > GILDONG MONITORING ACTIVE.<br>
        > CONNECTED TO SOCIAL GRAPH.<br>
    </div>

<script>
    // Initial Constraints (The "Norm" defined by society)
    const baseParams = {
        salary: 10,
        interest: 50,
        cost: 30
    };

    let currentParams = { ...baseParams };
    let suspicion = 0;
    let lifeScore = 0;
    let gameActive = true;

    // DOM Elements
    const els = {
        salary: document.getElementById('w-salary'),
        interest: document.getElementById('w-interest'),
        cost: document.getElementById('w-cost'),
        valSalary: document.getElementById('val-salary'),
        valInterest: document.getElementById('val-interest'),
        valCost: document.getElementById('val-cost'),
        score: document.getElementById('life-score'),
        suspicion: document.getElementById('suspicion'),
        log: document.getElementById('log'),
        meNode: document.getElementById('node-me')
    };

    function log(msg) {
        els.log.innerHTML += `> ${msg}<br>`;
        els.log.scrollTop = els.log.scrollHeight;
    }

    function calculateSuspicion() {
        // Suspicion rises based on deviation from "Normal" (L2 Regularization metaphor)
        let diffSalary = Math.abs(currentParams.salary - baseParams.salary);
        let diffInterest = Math.abs(currentParams.interest - baseParams.interest); // Inverted logic for game feel
        let diffCost = Math.abs(currentParams.cost - baseParams.cost);

        // Making salary increase or interest decrease suspicious
        let suspiciousness = (diffSalary * 2.5) + (diffInterest * 1.5) + (diffCost * 1.0);
        
        // Decay slightly if close to normal, but rise fast if hacking
        return Math.min(100, Math.max(0, suspiciousness));
    }

    function updateGame() {
        if (!gameActive) return;

        // 1. Get Input (Hacking)
        currentParams.salary = parseInt(els.salary.value);
        currentParams.interest = parseInt(els.interest.value);
        currentParams.cost = parseInt(els.cost.value);

        // Update UI Text
        els.valSalary.textContent = currentParams.salary;
        els.valInterest.textContent = currentParams.interest;
        els.valCost.textContent = currentParams.cost;

        // 2. Calculate Loss / Reward
        // Income + (Hidden Glitch Bonus?) - Debt - Cost
        let income = currentParams.salary * 10; 
        let expense = (currentParams.interest * 5) + (currentParams.cost * 5);
        
        let delta = income - expense;
        lifeScore += (delta / 60); // Accumulate over time (60fps approx)

        els.score.textContent = Math.floor(lifeScore).toLocaleString();
        els.score.style.color = lifeScore > 0 ? '#00ff41' : '#ff3333';

        // 3. GILDONG Logic (Adversarial)
        suspicion = calculateSuspicion();
        els.suspicion.textContent = Math.floor(suspicion) + "%";

        // Visual Feedback for Suspicion
        if (suspicion > 50) {
            els.suspicion.style.color = "orange";
        }
        if (suspicion > 80) {
            els.suspicion.style.color = "red";
            els.meNode.classList.add('danger');
        } else {
            els.suspicion.style.color = "var(--text-color)";
            els.meNode.classList.remove('danger');
        }

        // Win / Lose State
        if (suspicion >= 100) {
            gameOver("DETECTED BY GILDONG. PURGING NODE.");
        }
        if (lifeScore < -1000) {
            gameOver("BANKRUPTCY. REMOVED FROM SYSTEM.");
        }
        if (lifeScore > 2000) {
            gameWin("LOCAL MINIMA ESCAPED. INDEPENDENCE ACHIEVED.");
        }

        requestAnimationFrame(updateGame);
    }

    function gameOver(reason) {
        gameActive = false;
        log(`<span style="color:red">${reason}</span>`);
        document.body.style.opacity = "0.5";
        alert(reason);
        location.reload(); // Simple reset
    }

    function gameWin(reason) {
        gameActive = false;
        log(`<span style="color:cyan">${reason}</span>`);
        alert(reason);
    }

    // Start loop
    updateGame();

</script>
</body>
</html>
